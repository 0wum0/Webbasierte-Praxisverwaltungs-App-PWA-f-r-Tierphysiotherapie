{% extends "layout.twig" %}

{% block content %}
<div class="container py-4">

    <h2>👤 Besitzer: {{ owner.firstname }} {{ owner.lastname }}</h2>
    <p>
        📧 {{ owner.email }} · ☎️ {{ owner.phone }}<br>
        {{ owner.street }}, {{ owner.zipcode }} {{ owner.city }}
    </p>

    <!-- Tabs -->
    <ul class="nav nav-tabs" id="ownerTabs" role="tablist">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#patients">Patienten</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#appointments">Termine</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#invoices">Rechnungen</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#notes">Notizen</a></li>
    </ul>

    <div class="tab-content p-3 bg-dark text-light rounded-bottom shadow">

        <!-- Patienten -->
        <div class="tab-pane fade show active" id="patients">
            <h5>Patienten</h5>
            <ul class="list-group">
                {% for p in patients %}
                <li class="list-group-item d-flex justify-content-between">
                    {{ p.name }} ({{ p.species }} – {{ p.breed }})
                    <a href="patient.php?id={{ p.id }}" class="btn btn-sm btn-outline-info">Profil öffnen</a>
                </li>
                {% else %}
                <li class="list-group-item">Keine Patienten vorhanden</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Termine -->
        <div class="tab-pane fade" id="appointments">
            <h5>Termine</h5>
            <ul class="list-group">
                {% for a in appointments %}
                <li class="list-group-item d-flex justify-content-between">
                    {{ a.appointment_date|date("d.m.Y H:i") }} – {{ a.patient_name }}
                    <span class="text-muted">{{ a.notes|default("Keine Notizen") }}</span>
                </li>
                {% else %}
                <li class="list-group-item">Keine Termine vorhanden</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Rechnungen -->
        <div class="tab-pane fade" id="invoices">
            <h5>Rechnungen</h5>
            <ul class="list-group">
                {% for inv in invoices %}
                <li class="list-group-item d-flex justify-content-between">
                    #{{ inv.id }} – {{ inv.patient_name }} – {{ inv.amount|number_format(2, ',', '.') }} € – {{ inv.status }}
                    <a href="invoice_pdf.php?id={{ inv.id }}" target="_blank" class="btn btn-sm btn-outline-info">PDF</a>
                </li>
                {% else %}
                <li class="list-group-item">Keine Rechnungen vorhanden</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Notizen -->
        <div class="tab-pane fade" id="notes">
            <h5>Notizen</h5>

            <form method="post" class="mb-3">
        {{ csrf_field()|raw }}
                <textarea name="note_content" class="form-control mb-2" rows="3" placeholder="Neue Notiz eingeben..." required></textarea>
                <button type="submit" class="btn btn-success">💾 Notiz speichern</button>
            </form>

            <ul class="list-group">
                {% for n in notes %}
                <li class="list-group-item">
                    {{ n.content }}
                    <br><small class="text-muted">{{ n.created_at|date("d.m.Y H:i") }}</small>
                    <a href="owner.php?id={{ owner.id }}&delete_note={{ n.id }}" class="btn btn-sm btn-danger float-end" onclick="return confirm('Notiz wirklich löschen?');">🗑️ Löschen</a>
                </li>
                {% else %}
                <li class="list-group-item">Keine Notizen vorhanden</li>
                {% endfor %}
            </ul>
        </div>

    </div>

    <a href="owners.php" class="btn btn-outline-light mt-3">↩️ Zurück zur Besitzerliste</a>

</div>
{% endblock %}